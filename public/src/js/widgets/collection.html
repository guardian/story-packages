<div class="collection" data-bind="ownerClass: $data">
    <div class="list-header">

        <span class="title" data-bind="
            text: configMeta.displayName() || collectionMeta.displayName() || '(no title)'"></span>

        <span class="count" data-bind="if: !isPending()">
            (<span data-bind="
                text: state.count() ? state.count() : 'empty',
                css: {'non-zero':  state.count}"></span>)
        </span>

        <span class="count" data-bind="if: isPending()">
            (<span class="non-zero">updating...</span>)
        </span>

        <span class="list-header__timings" data-bind="
            css: {'has-concurrent-user': state.hasConcurrentEdits}">
            <!-- ko if: state.timeAgo -->
                <span class="list-header__timings__last-updated" data-bind="text: state.timeAgo"></span>
                by <span class="list-header__timings__user" data-bind="text: collectionMeta.updatedBy"></span>
            <!-- /ko -->
            <a data-bind="
                click: reset,
                visible: state.hasConcurrentEdits,
                ">Show edits</a>
        </span>
    </div>

    <div class="article-group">
        <div data-bind="
            css: {'pending': isPending()},
            template: {name: 'template_groups', foreach: groups}"></div>
    </div>
</div>

<!-- ko if: state.hasExtraActions() && isHistoryEnabled() -->
    <hr>

    <div class="buttons">
        <button data-bind="toggleClick: state.isHistoryOpen">
            <span>Previously</span>
            <!-- ko if: state.isHistoryOpen -->
                <i class="fa fa-chevron-down"></i>
            <!-- /ko -->
            <!-- ko ifnot: state.isHistoryOpen -->
                <i class="fa fa-chevron-up"></i>
            <!-- /ko -->
        </button>
    </div>

    <div class="history" data-bind="
        slideVisible: state.isHistoryOpen(),
        makeDraggable: true
    ">
        <!-- ko foreach: history -->
            <trail-widget params="context: $context"></trail-widget>
        <!-- /ko -->
    </div>
<!-- /ko -->


<script type="text/html" id="template_groups">
    <!-- ko if: name -->
        <div class="group-name" data-bind="text: name"></div>
    <!-- /ko -->
    <div class="droppable" data-bind="
        makeDroppable: true,
        click: pasteItem,
        css: {
            underDrag: underDrag() && !underControlDrag(),
            underControlDrag: underDrag() && underControlDrag()
        }">
            <!-- ko foreach: items -->
                <trail-widget params="context: $context"></trail-widget>
            <!-- /ko -->
            <div class="group-separator" data-bind="css: {'pasteOver': $root.isPasteActive && $root.isPasteActive()}">
                <span class="helptext">Click to paste</span>
            </div>
    </div>
</script>
